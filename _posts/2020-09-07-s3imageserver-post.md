---
title:  "S3를 이용한 이미지 서버 구축하기"
description: "S3를 이용한 이미지 서버 구축하기"
date: 2020-09-07 20:26:28 -0400
categories: devlopment
thumbnail: "/assets/images/s3imageserver/2020-09-07-01.png"
sitemap :
  changefreq : daily
  priority : 1.0
---

>안녕하세요. DX혁신부문 학원솔루션개발팀에 이병철입니다. :)  
>저희팀에서 기존 웹서버에 구축된 이미지서버를 CloudFront와 S3 구성으로 변경하고 이에 문제점들을 해결하기위한 과정을 수행하게 되었습니다.  
>구글링에서 나온 문서를 토대로 구축해서 진행을 해도 되겠지만 기존방식과의 차이점 또는 성능이슈를 분석하고 올바른 길로 가기위해 불필요한? 아닌 필요한 테스트를 좀 해보았습니다.  

## 아키텍처
먼저 팀내에 프론트 아키텍처를 구성해 보고 이 방안이 맞는건지 조심스럽게 접근하기로 했습니다.

![이미지1](/assets/images/s3imageserver/2020-09-07-01.png)


| | CloudFront + S3 | NginX + S3 |
|:---|:---:|:---:|
|글로벌서비스|해당사항없음 ||
|사용량| 일 평균 트래픽 80GB / 월평균 2.4TB ||
|비용| 예상비용 $40 미만| 예상비용 $10 내외 |
|파일 무효화| 필요 | 없음 |
|파일 무효화 비용| 필요 | 없음 |
|보안| HTTPS | HTTPS + S3 endpoint(http)|
|요청제한| 엣지로케이션 활용 | GET:5500/sec (최상위폴더기준) |
|작업공수| 없음 | 별도구축필요 |
|비용안분| 필요 | 없음(빌링태그) |

> 요청제한의 경우 자동 재시도 로직 구현필요 또는 최상위 펄더를 상세하게 분류 (팀 상황으로 보면 요청건수가 적음으로 해당사항없음)  

위에 표를 가지고 비교를 해보니 Nginx로 가는게 저렴해 보입니다.  
ec2 비용이 나올건데 저렴하지? 라고 말하실듯 해서 원래 웹서버에 추가해서 구축하게 되면 비용이 안나오게 됩니다.  
저희는 비용 대비 작업공수와 속도를 비교해서 결정하기로 했습니다.

## 비용

1. **CloudFront + S3**  

![이미지2](/assets/images/s3imageserver/2020-09-07-02.png)

~~~~~~~~
월 데이터 전송 2.4TB 비용 = $40.6 예상 + S3저장비용
~~~~~~~~

2. **Nginx + S3**    

![이미지3](/assets/images/s3imageserver/2020-09-07-03.png)

~~~~~~~~
월 데이터 전송 2.4TB 비용 + S3저장비용 = 최대 $10 예상
~~~~~~~~

비용은 뭐 거기서 거기구만 특히 몇만원더 나온다고 특별히 문제가 되지 않을거고 기존에 EFS 비용에 비해 현저히 낮은 비용이 나오기 때문에 작업공수라도 줄여야 한다고 생각했습니다.  
한 50%정도는 CF+S3로 마음이 치우쳤네요. 그런데 한가지 마음에 걸리는게 있습니다.  

## 캐싱
![이미지4](/assets/images/s3imageserver/2020-09-07-04.png)

~~~~~~~~
* S3 파일업로드후 메타데이터를 추가 (TTL 세팅)
* aws cli 또는 url 을 이용한 무효화 방안 (파일 or 폴더지정)
* 파일명 또는 폴더명에 버전관리 or QueryString
~~~~~~~~
